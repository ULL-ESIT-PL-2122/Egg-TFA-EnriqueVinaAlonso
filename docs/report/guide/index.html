<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EGGXTENDED | Vuepress Docs Boilerplate</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/css/0.styles.d2c0b82c.css" as="style"><link rel="preload" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/app.b094a93f.js" as="script"><link rel="preload" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/2.eb6e313d.js" as="script"><link rel="preload" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/10.df43cf17.js" as="script"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/11.b34261bb.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/3.5f255e2e.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/4.1d50d501.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/5.6df2c662.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/6.d7e152ce.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/7.0404d379.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/8.1dd5790e.js"><link rel="prefetch" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/9.54764661.js">
    <link rel="stylesheet" href="/tfa-enrique-vina-alonso-alu0101337760/report/assets/css/0.styles.d2c0b82c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/tfa-enrique-vina-alonso-alu0101337760/report/" class="home-link router-link-active"><!----> <span class="site-name">Vuepress Docs Boilerplate</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/tfa-enrique-vina-alonso-alu0101337760/report/guide/" aria-current="page" class="active sidebar-link">EGGXTENDED</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/tfa-enrique-vina-alonso-alu0101337760/report/guide/#clases-en-egg" class="sidebar-link">Clases en egg:</a></li><li class="sidebar-sub-header"><a href="/tfa-enrique-vina-alonso-alu0101337760/report/guide/#traduccion-de-egg-a-js" class="sidebar-link">Traducción de egg a JS</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="eggxtended"><a href="#eggxtended" class="header-anchor">#</a> EGGXTENDED</h1> <p><a href="/tfa-enrique-vina-alonso-alu0101337760/report/coverage/lcov-report/">COVERAGE</a></p> <h2 id="clases-en-egg"><a href="#clases-en-egg" class="header-anchor">#</a> Clases en egg:</h2> <h3 id="idea-principal"><a href="#idea-principal" class="header-anchor">#</a> Idea principal</h3> <p>La lógica a seguir para implmenter una clase en egg es bastante similar a la que ya hemos seguido para implementar objetos, la diferencia es que la declaración de una clase creará un objeto en el entorno dado que almacene cada una de las properties de la clase, de forma similar a un objeto. La principal diferencia es que este objeto definición de clase tendrá un método <code>new</code> que permitirá crear una instancia de la clase.</p> <h3 id="sintaxis"><a href="#sintaxis" class="header-anchor">#</a> Sintaxis</h3> <p>La sintaxis propuesta es la siguiente:</p> <div class="language-egg extra-class"><pre class="language-text"><code>class( point, 
    x: 0,
    y: 0, 
    moveUp: fun(
            =(
                self[&quot;y&quot;],
                +(self[&quot;y&quot;], 1)
            )                
        ),
    constructor: fun(x, y, 
        do(
            =(self[&quot;x&quot;], x),
            =(self[&quot;y&quot;], y)
        )
    )
)
</code></pre></div><p>El primer parámetro de <code>class</code> será un nombre de clase, luego se definirán las propiedades de la clase.
Además no es necesario que la clase tenga un constructor, se puede simplmemente definir los valores por defecto a cada atributo.</p> <h3 id="implementacion"><a href="#implementacion" class="header-anchor">#</a> Implementación</h3> <p>La implmentación prouesta es la siguiente:</p> <div class="language-js extra-class"><pre class="language-js"><code>specialForms<span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> env</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">'Error!: Class number of parameters must be at least 2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">'word'</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">'Error!: First parameter must be a word'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> className <span class="token operator">=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">'Error!: Class must have pairs of property names and property values'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> propertiesTree <span class="token operator">=</span> args<span class="token punctuation">;</span>
  <span class="token keyword">let</span> newClass <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  newClass<span class="token punctuation">.</span><span class="token function-variable function">new</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>constructorArgs</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> instanceEnv <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>env<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> instance <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    instanceEnv<span class="token punctuation">[</span><span class="token string">&quot;self&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">let</span> constructor<span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> propertiesTree<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> name <span class="token operator">=</span> propertiesTree<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> propertiesTree<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>instanceEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>      
      <span class="token keyword">let</span> value <span class="token operator">=</span> propertiesTree<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">evaluate</span><span class="token punctuation">(</span>instanceEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">===</span> <span class="token string">&quot;constructor&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        constructor <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">continue</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      instance<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> instanceEnv<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>constructor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token operator">...</span>constructorArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>      
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> instance<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  env<span class="token punctuation">[</span>className<span class="token punctuation">]</span> <span class="token operator">=</span> newClass<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Añadiremos una nueva función <code>class</code> a <code>specialForms</code>, las primeras líneas de la función están destinadas a comprobar que los argumentos son correctos, y a la extracción del nombre de la nueva clase a definir. A continuación se definirá un objeto <code>newClass</code> que contendrá un método <code>new</code> que permitirá crear una instancia de la clase.</p> <p>El método new recibirá como argumentos, los parámetros del constructor, si lo hubiese, y creará una nueva instancia de la clase de una forma similar a la ya implementada para los objetos, si se encuentra que la definición de la clase tiene un método constructor mientras se recorren las propiedades de la definición de la clase, este se llama al final de la creación de la instancia.</p> <h2 id="traduccion-de-egg-a-js"><a href="#traduccion-de-egg-a-js" class="header-anchor">#</a> Traducción de egg a JS</h2> <p>Para traducir una clase en JS, se añadieron los siguientes ficheros:</p> <ul><li><code>runtime-support.js</code>: en el caso de las funciones exclusivas de egg, como print, runtime-support.js contiene las funciones equivalentes en js.</li> <li><code>scope.js</code>: contine funciones de utilidad para el manejo de las variables y entornos.</li> <li><code>translations.js</code>: continene las funciones de traducción de las expresiones en js.</li></ul> <h3 id="modificacion-de-las-clases-nodos-del-ast"><a href="#modificacion-de-las-clases-nodos-del-ast" class="header-anchor">#</a> Modificación de las clases nodos del AST</h3> <p>Para facilitar la tarea de traducción se le añadirá a cada una de las clases un método <code>generateJS</code> que retornará una string con el código equivalente en JS.</p> <h4 id="nodo-value"><a href="#nodo-value" class="header-anchor">#</a> Nodo <code>Value</code></h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">generateJS</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">'number'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">'</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>Simplemente devolveremos el valor del nodo.</p> <h4 id="nodo-word"><a href="#nodo-word" class="header-anchor">#</a> Nodo <code>Word</code></h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">generateJS</span><span class="token punctuation">(</span><span class="token parameter">scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> eggName <span class="token operator">=</span> <span class="token string">'$'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
    <span class="token function">setAsUsed</span><span class="token punctuation">(</span>scope<span class="token punctuation">,</span> eggName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> eggName<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>En la traducción de un nodo <code>Word</code> se generará un nombre precedido con un símbolo especial para identificar las variables de usuario (en este caso <code>$</code>),
además se maracará esta variable como usada.</p> <h4 id="nodo-apply"><a href="#nodo-apply" class="header-anchor">#</a> Nodo <code>Apply</code></h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">generateJS</span><span class="token punctuation">(</span><span class="token parameter">scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'word'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">//comprobamos si es una función de egg</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>generateJSForms<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> generateJSForms<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">,</span> scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> opTranslation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// si ha sido declarado</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>opTranslation <span class="token operator">&amp;&amp;</span> scope<span class="token punctuation">[</span>opTranslation<span class="token punctuation">]</span><span class="token punctuation">.</span>declared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> argsTranslated <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>opTranslation<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argsTranslated<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// si no está declarado, damos un warning, error si es un special forms</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>opTranslation <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>scope<span class="token punctuation">[</span>opTranslation<span class="token punctuation">]</span><span class="token punctuation">.</span>declared<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name <span class="token keyword">in</span> specialForms<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">let</span> errorMsg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Translation of &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; not implemented yet.\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errorMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
            process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
          console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Warning: Non declared symbol &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot; used as function.\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> argsTranslated <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>opTranslation<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argsTranslated<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> errMsg <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Fatal error.\n</span><span class="token template-punctuation string">`</span></span> <span class="token operator">+</span>
            <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">AST=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.\nscope=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.\n</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
          process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'apply'</span> <span class="token operator">||</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>type <span class="token operator">==</span> <span class="token string">'property'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> argsTranslated <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>argsTranslated<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>La traducción de un nodo <code>Apply</code> es mucho más compleja en comparación con el resto de nodos. Según el tipo del nodo operator, se traducirá de una forma u otra.</p> <p>En el caso de que el operador sea <code>word</code> se comprueba si es una función de egg, en caso de serlo, se llama a la función correspondiente.
En caso contrario, se trata de una función declarada por el usuario, entonces, si la función ha sido declarada, traduciremos el nombre de la función y sus argumentos, si no, generamos un warning.</p> <p>En el caso de que el operador sea un <code>apply</code> o ``property<code>, se traducen todos los argumentos y se llama a</code>generateJS` sobre el operador.</p> <h4 id="nodo-property"><a href="#nodo-property" class="header-anchor">#</a> Nodo <code>Property</code></h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token function">generateJS</span><span class="token punctuation">(</span><span class="token parameter">scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> left <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'self'</span> <span class="token operator">?</span> <span class="token string">'this'</span> <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>operator<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> left <span class="token operator">+</span> <span class="token string">'['</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">']'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>La traducción de un nodo property es bastante simple, simplemente traduciremos la parte izquierda de la propiedad y la parte derecha y devolveremos una string con la sintaxis correcta en js.
Cabe destacar que en el caso de que la parte izquierda sea <code>self</code>, se traducirá como <code>this</code>.</p> <h3 id="traduccion-de-funciones"><a href="#traduccion-de-funciones" class="header-anchor">#</a> Traducción de funciones</h3> <h4 id="fun"><a href="#fun" class="header-anchor">#</a> fun</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">&quot;fun&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> generateJSForms<span class="token punctuation">[</span><span class="token string">&quot;-&gt;&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> newEnv <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> body <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>newEnv<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> params <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>newEnv<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">function(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>params<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) { 
      return (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>body<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">);     
    }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Traducir una declaración de función egg básicamente traduciremos cada uno de los parámetros y el cuerpo de la función, y devolveremos una string con la definición de la función en JS.</p> <h4 id="do"><a href="#do" class="header-anchor">#</a> do</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">&quot;do&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> argsTranslated <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> lastOne <span class="token operator">=</span> argsTranslated<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token function-variable function">template</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">expressions<span class="token punctuation">,</span> lastOne</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(()=&gt;{
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>expressions<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">';\n'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
        return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>lastOne<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
      })()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> temp <span class="token operator">=</span> <span class="token function">template</span><span class="token punctuation">(</span>argsTranslated<span class="token punctuation">,</span> lastOne<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>La traducción de un do es bastante similar a la traducción de una función, pero en este caso, traduciremos cada una de las sentencias del do. Para mantener el mismo comportamiento en la traducción, deberemos devolver la última sentencia en la función js resultante.</p> <h4 id="while"><a href="#while" class="header-anchor">#</a> while</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">'while'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Wrong number of arguments for while'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>cond<span class="token punctuation">,</span> body<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> last <span class="token operator">=</span> <span class="token function">tempVar</span><span class="token punctuation">(</span><span class="token string">'last'</span><span class="token punctuation">,</span> scope<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">(()=&gt;{
        while (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cond<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) 
         </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>last<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>body<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
        return </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>last<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
    })()</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Los bucles while en egg devuelven el resultado de la evaluación del bucle, por lo que necesitaremos una variaable temporal para almacenar el resultado de la evaluación de la condición.</p> <h4 id="array"><a href="#array" class="header-anchor">#</a> array</h4> <div class="language-js extra-class"><pre class="language-js"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">'array'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token string">'['</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    output <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  output <span class="token operator">+=</span> <span class="token string">']'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> output<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La traducción de un array es muy simple, simplemente se encapsulará entre corchetes el resultado de la traducción de cada uno de los elementos del array.</p> <h4 id="if"><a href="#if" class="header-anchor">#</a> if</h4> <div class="language-js extra-class"><pre class="language-js"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">'if'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">SyntaxError</span><span class="token punctuation">(</span><span class="token string">'Bad number of args to if'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> <span class="token punctuation">[</span>cond<span class="token punctuation">,</span> then<span class="token punctuation">,</span> else_<span class="token punctuation">]</span> <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">arg</span> <span class="token operator">=&gt;</span> arg<span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">if(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>cond<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>then<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> } else { </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>else_<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> }</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p>Para traducir un if, primero comprobaremos que el nodo tiene el número de argumentos adecuados, luego simplemente traduciremos las expresiones de la condición, el cuerpo del if y el cuerpo del else y devolveremos una string con la definición de la función en JS.</p> <h4 id="object"><a href="#object" class="header-anchor">#</a> object</h4> <div class="language-js extra-class"><pre class="language-js"><code>generateJSForms<span class="token punctuation">[</span><span class="token string">'object'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">args<span class="token punctuation">,</span> scope</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>args<span class="token punctuation">.</span>length <span class="token operator">%</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid number of arguments for object&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token string">'{'</span>
  <span class="token keyword">let</span> name<span class="token punctuation">;</span>
  <span class="token keyword">let</span> value<span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> args<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">+=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    name <span class="token operator">=</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">getIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> args<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
    value <span class="token operator">=</span> args<span class="token punctuation">[</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">generateJS</span><span class="token punctuation">(</span>scope<span class="token punctuation">)</span><span class="token punctuation">;</span>
    output <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  output <span class="token operator">+=</span> <span class="token string">'}'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> output<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>La traducción de los objetos es similar a la traducción de un array. En este caso tendremos que traducir los pares de claves y valores asegurandonos de añadir los elementos sintácticos de js.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/app.b094a93f.js" defer></script><script src="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/2.eb6e313d.js" defer></script><script src="/tfa-enrique-vina-alonso-alu0101337760/report/assets/js/10.df43cf17.js" defer></script>
  </body>
</html>
